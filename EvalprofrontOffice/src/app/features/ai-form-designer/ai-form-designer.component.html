<!-- ai-form-designer.component.html -->
<div class="ai-wrap">
  <header class="ai-head">
    <h1>AI Form Designer</h1>
    <p>Décris l’étape et laisse l’IA générer un formulaire. Tu peux ensuite l’enregistrer.</p>
  </header>

  <section class="ai-grid">
    <!-- Panneau de saisie (gauche) -->
    <div class="panel brief">
      <div class="brief-form">
        <div class="row">
          <label for="stepId">Step ID</label>
          <input
            id="stepId"
            type="number"
            name="stepId"
            min="1"
            [(ngModel)]="stepId"
            (ngModelChange)="onStepChange($event)"
            autocomplete="off"
          />
        </div>

        <div class="row">
          <label for="stepName">Nom d'étape</label>
          <input
            id="stepName"
            type="text"
            name="stepName"
            [(ngModel)]="stepName"
            autocomplete="off"
          />
        </div>

        <div class="row">
          <label for="desc">Consignes (ce que tu veux dans le formulaire)</label>
          <textarea
            id="desc"
            name="description"
            rows="4"
            [(ngModel)]="description"
            (keydown.enter)="$event.preventDefault()"
            placeholder="Ex: Nom du projet, budget (nombre), catégorie (liste), description courte..."
          ></textarea>
        </div>

        <div class="actions">
          <!-- type=button pour éviter toute soumission -->
          <button type="button" [disabled]="loading" (click)="generate()">
            <i class="fas fa-wand-magic-sparkles"></i>
            {{ loading ? 'Génération...' : 'Générer' }}
          </button>

          <button
            type="button"
            class="ghost"
            (click)="save()"
            [disabled]="!schema || saving"
          >
            <i class="fas fa-save"></i>
            {{ saving ? 'Enregistrement...' : 'Enregistrer' }}
          </button>

          <label class="toggle">
            <input type="checkbox" [(ngModel)]="chatMode" name="chatMode" />
            Mode chat (beta)
          </label>
        </div>

        <p class="err" *ngIf="error">{{ error }}</p>
      </div>
    </div>

    <!-- Aperçu (droite) -->
    <div class="panel preview" *ngIf="schema; else empty">
      <h3 class="title">{{ schema.title }}</h3>

      <!-- on bloque toute soumission involontaire -->
      <form class="preview-form" (submit)="$event.preventDefault()">
        <div class="f" *ngFor="let f of schema.fields; trackBy: trackByIndex">
          <label>
            {{ f.label }}
            <span *ngIf="f.required" class="req">*</span>
          </label>

          <!-- text / number / date -->
          <input
            *ngIf="f.type === 'text' || f.type === 'number' || f.type === 'date'"
            [attr.type]="f.type === 'text' ? 'text' : f.type"
            [(ngModel)]="f.value"
            [ngModelOptions]="{ standalone: true }"
            [placeholder]="f.placeholder || ''"
            [required]="!!f.required"
            autocomplete="off"
          />

          <!-- textarea -->
          <textarea
            *ngIf="f.type === 'textarea'"
            [(ngModel)]="f.value"
            [ngModelOptions]="{ standalone: true }"
            [placeholder]="f.placeholder || ''"
            [required]="!!f.required"
          ></textarea>

          <!-- select -->
          <select
            *ngIf="f.type === 'select'"
            [(ngModel)]="f.value"
            [ngModelOptions]="{ standalone: true }"
            [required]="!!f.required"
          >
            <option [ngValue]="null" disabled>— Choisir —</option>
            <option *ngFor="let o of f.options" [ngValue]="o">{{ o }}</option>
          </select>

          <!-- checkbox -->
          <label class="check" *ngIf="f.type === 'checkbox'">
            <input
              type="checkbox"
              [(ngModel)]="f.value"
              [ngModelOptions]="{ standalone: true }"
            />
            {{ f.placeholder || 'Oui / Non' }}
          </label>
        </div>
      </form>
    </div>

    <ng-template #empty>
      <div class="panel empty">
        <p>Lance une génération pour voir un aperçu.</p>
      </div>
    </ng-template>
  </section>
</div>
