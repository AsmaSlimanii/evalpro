<div class="page container">
    <div class="header">
        <h1>Dossiers soumis</h1>
        <span *ngIf="total" class="total">{{ total }} dossiers</span>
    </div>

    <div class="toolbar">
        <div class="search">
            <i class="fas fa-search"></i>
            <input [(ngModel)]="q" placeholder="Rechercher titre / email…" />
        </div>

        <select [(ngModel)]="status" (change)="setPage(0)">
            <option value="SOUMIS">Soumis</option>
            <option value="ACCEPTE">Acceptés</option>
            <option value="REJETE">Rejetés</option>
            <option value="EN_COURS">En cours</option>
        </select>

        <button class="btn ghost" (click)="load()" [disabled]="loading">
            <i class="fas fa-sync"></i> Rafraîchir
        </button>
    </div>

    <div class="card">
        <div *ngIf="message" class="alert">{{ message }}</div>

        <div class="table">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Titre</th>
                        <th>Propriétaire</th>
                        <th>Soumis le</th>
                        <th>Statut</th>
                        <th style="width:1%"></th>
                    </tr>
                </thead>

                <tbody>
                    <!-- Skeletons pendant chargement -->
                    <ng-container *ngIf="loading">
                        <tr *ngFor="let _ of [1,2,3,4,5]" class="skeleton-row">
                            <td colspan="6">
                                <div class="sk"></div>
                            </td>
                        </tr>
                    </ng-container>

                    <!-- Lignes réelles -->
                    <tr *ngFor="let d of filteredRows">
                        <td>{{ d.id }}</td>
                        <td>{{ d.titre }}</td>
                        <td>{{ d.ownerEmail }}</td>
                        <td>{{ d.submittedAt | date: 'dd/MM/yyyy, HH:mm' }}</td>
                        <td>
                            <span class="badge" [ngClass]="d.status">
                                {{ labels[d.status] || d.status }}
                            </span>
                        </td>
                        <!-- en-tête -->
                        <th class="col-actions">Actions</th>

                        <!-- ligne -->
                        <td class="row-actions">
                            <button class="btn tiny" (click)="open(d.id)" title="Ouvrir dans un onglet">
                                <i class="fas fa-eye"></i> Voir
                            </button>

                            <button class="btn tiny primary" (click)="download(d.id, d.titre)" title="Télécharger PDF">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </td>


                    </tr>

                    <tr *ngIf="!loading && !filteredRows.length">
                        <td colspan="6" class="empty">Aucun dossier.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="pager" *ngIf="total > size">
            <button class="btn tiny" (click)="setPage(page - 1)" [disabled]="page === 0">
                Précédent
            </button>
            <span>Page {{ page + 1 }} / {{ Math.ceil(total / size) }}</span>
            <button class="btn tiny" (click)="setPage(page + 1)" [disabled]="(page + 1) >= Math.ceil(total / size)">
                Suivant
            </button>
        </div>
    </div>
</div>