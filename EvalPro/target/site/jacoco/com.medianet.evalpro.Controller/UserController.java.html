<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">EvalPro</a> &gt; <a href="index.source.html" class="el_package">com.medianet.evalpro.Controller</a> &gt; <span class="el_source">UserController.java</span></div><h1>UserController.java</h1><pre class="source lang-java linenums">package com.medianet.evalpro.Controller;

import com.medianet.evalpro.Entity.User;
import com.medianet.evalpro.Repository.UserRepository;
import com.medianet.evalpro.Service.UserService;
import lombok.RequiredArgsConstructor;
import org.springframework.data.domain.Page;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;


import java.util.HashMap;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping(&quot;/api/users&quot;)
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;


    // ðŸ”¹ CREATE
    @PostMapping
    public ResponseEntity&lt;User&gt; createUser(@RequestBody User user) {
<span class="nc" id="L27">        return ResponseEntity.ok(userService.save(user));</span>
    }

    // ðŸ”¹ READ ALL
    @GetMapping
    public ResponseEntity&lt;List&lt;User&gt;&gt; getAllUsers() {
<span class="nc" id="L33">        return ResponseEntity.ok(userService.findAll());</span>
    }

    // ðŸ”¹ READ ONE BY ID
    @GetMapping(&quot;/{id}&quot;)
    public ResponseEntity&lt;User&gt; getUserById(@PathVariable Long id) {
<span class="nc" id="L39">        return userService.findById(id)</span>
<span class="nc" id="L40">                .map(ResponseEntity::ok)</span>
<span class="nc" id="L41">                .orElse(ResponseEntity.notFound().build());</span>
    }

    // ðŸ”¹ UPDATE
    @PutMapping(&quot;/{id}&quot;)
    public ResponseEntity&lt;User&gt; updateUser(@PathVariable Long id, @RequestBody User user) {
        try {
<span class="nc" id="L48">            User updatedUser = userService.update(id, user);</span>
<span class="nc" id="L49">            return ResponseEntity.ok(updatedUser);</span>
<span class="nc" id="L50">        } catch (RuntimeException e) {</span>
<span class="nc" id="L51">            return ResponseEntity.notFound().build();</span>
        }
    }

    // ðŸ”¹ DELETE
    @DeleteMapping(&quot;/{id}&quot;)
    public ResponseEntity&lt;Void&gt; deleteUser(@PathVariable Long id) {
        try {
<span class="nc" id="L59">            userService.deleteById(id);</span>
<span class="nc" id="L60">            return ResponseEntity.noContent().build();</span>
<span class="nc" id="L61">        } catch (RuntimeException e) {</span>
<span class="nc" id="L62">            return ResponseEntity.notFound().build();</span>
        }
    }


    @GetMapping(&quot;/search&quot;)
    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; searchUsers(
            @RequestParam(defaultValue = &quot;1&quot;) int page,
            @RequestParam(name = &quot;per_page&quot;, defaultValue = &quot;10&quot;) int size,
            @RequestParam(name = &quot;q&quot;, defaultValue = &quot;&quot;) String query) {

<span class="nc" id="L73">        Page&lt;User&gt; userPage = userService.searchUsers(query, page - 1, size); // Quand l'utilisateur demande page=1, on fait page-1 = 0 âž” Spring lit bien page 0 (la premiÃ¨re page).</span>
<span class="nc" id="L74">        Map&lt;String, Object&gt; resp = new HashMap&lt;&gt;();</span>
<span class="nc" id="L75">        resp.put(&quot;data&quot;, userPage.getContent());</span>
<span class="nc" id="L76">        resp.put(&quot;page&quot;, userPage.getNumber() + 1); // Remettre +1 pour l'affichage</span>
<span class="nc" id="L77">        resp.put(&quot;per_page&quot;, userPage.getSize());</span>
<span class="nc" id="L78">        resp.put(&quot;total&quot;, userPage.getTotalElements());</span>

        // âš¡ Optionnel : ajouter info invalid users
<span class="nc" id="L81">        long invalidCount = userPage.getContent().stream()</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">                .filter(user -&gt; user.getRole() == null)</span>
<span class="nc" id="L83">                .count();</span>
<span class="nc" id="L84">        resp.put(&quot;invalid_users&quot;, invalidCount);</span>

<span class="nc" id="L86">        return ResponseEntity.ok(resp);</span>
    }







    // âœ… MÃ©thode Ã  ajouter ici
   // @GetMapping(&quot;/current-user&quot;)
  //  public ResponseEntity&lt;?&gt; getCurrentUser(Principal principal) {
   //     String username = principal.getName();
    //    User user = (User) userRepository.findByUsername(username)
      //          .orElseThrow(() -&gt; new RuntimeException(&quot;Utilisateur non trouvÃ©&quot;));
     //   return ResponseEntity.ok(Map.of(&quot;id&quot;, user.getId()));
 //   }



    // Avec Ã§a, tes endpoints &quot;GET /api/users?page=0&amp;per_page=20&amp;q=asma&quot; ==&gt; renverront un JSON professionnel incluant :
    //
    //data : liste des utilisateurs sur la page
    //
    //page : numÃ©ro de la page
    //
    //per_page : taille de page
    //
    //total : nombre total dâ€™Ã©lÃ©ments
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>